<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UTL Document Portal</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #4e54c8, #8f94fb);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #333;
    }
    .container {
      max-width: 400px;
      width: 100%;
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      text-align: center;
    }
    .logo {
      width: 80px;
      margin-bottom: 10px;
    }
    h2, h3 {
      margin: 5px 0;
    }
    input, button {
      padding: 12px;
      margin: 10px 0;
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
    }
    button {
      background: #4e54c8;
      color: white;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #3b40a0;
    }
    .hidden {
      display: none !important;
    }
    #loading {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6); color: white; display: none;
      justify-content: center; align-items: center; font-size: 24px; z-index: 999;
    }
    a {
      display: block;
      margin: 5px 0;
      color: #4e54c8;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div id="loading">Uploading...</div>
  <div class="container">
    <img src="data:image/png;base64,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" alt="Company Logo" class="logo">
    <h2>United Telecom Limited</h2>
    <h3>Document Portal</h3>

    <div id="login-section">
      <input type="text" id="empId" placeholder="Employee ID or 'admin'" />
      <input type="password" id="password" placeholder="Password" />
      <button id="loginBtn">Login</button>
      <p id="login-error" style="color: red;"></p>
    </div>

    <div id="employee-section" class="hidden">
      <h4 id="welcome-emp">Welcome, Employee</h4>
      <div id="file-list"></div>
      <button onclick="logout()">Logout</button>
    </div>

    <div id="admin-section" class="hidden">
      <h4>Welcome, Admin</h4>

      <input type="file" id="uploadFile" />
      <button id="uploadBtn">Upload</button>
      <p id="upload-status"></p>

      <h5>Add New Employee</h5>
      <input type="text" id="newEmpId" placeholder="Employee ID" />
      <input type="password" id="newEmpPass" placeholder="Password" />
      <button id="addEmpBtn">Create Employee</button>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = 'https://mjdgoqnvkmmutenruqxc.supabase.co';
    const SUPABASE_KEY = 'YOUR_SUPABASE_KEY';
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

    function showLoading(show) {
      const loading = document.getElementById('loading');
      loading.style.display = show ? 'flex' : 'none';
    }

    async function login() {
      const empId = document.getElementById('empId').value.trim();
      const password = document.getElementById('password').value.trim();
      const errorDisplay = document.getElementById('login-error');
      errorDisplay.textContent = '';

      if (empId === 'admin' && password === 'karthik') {
        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('admin-section').classList.remove('hidden');
        return;
      }

      const { data, error } = await supabaseClient.from('profiles').select('*').eq('emp_id', empId).single();
      if (error || !data) {
        errorDisplay.textContent = 'Employee not found.';
        return;
      }

      if (data.password !== password) {
        errorDisplay.textContent = 'Incorrect password.';
        return;
      }

      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('employee-section').classList.remove('hidden');
      document.getElementById('welcome-emp').textContent = `Welcome, ${data.emp_id}`;
      loadFiles();
    }

    async function uploadDocument() {
      const fileInput = document.getElementById('uploadFile');
      const file = fileInput.files[0];
      const statusText = document.getElementById('upload-status');
      statusText.textContent = '';
      if (!file) {
        alert('Please select a file to upload.');
        return;
      }

      showLoading(true);
      const { error } = await supabaseClient.storage.from('documents').upload(`uploads/${Date.now()}-${file.name}`, file, { upsert: true });
      showLoading(false);

      if (error) {
        statusText.style.color = 'red';
        statusText.textContent = '❌ Upload failed.';
      } else {
        statusText.style.color = 'green';
        statusText.textContent = '✅ Upload successful!';
      }
    }

    async function addEmployee() {
      const empId = document.getElementById('newEmpId').value.trim();
      const password = document.getElementById('newEmpPass').value.trim();
      if (!empId || !password) return alert('Enter both ID and password');

      const { error } = await supabaseClient.from('profiles').insert([{ emp_id: empId, password }]);
      if (error) return alert('Failed to add employee');
      alert('Employee added successfully');
    }

    async function loadFiles() {
      const { data, error } = await supabaseClient.storage.from('documents').list('uploads');
      if (error) return alert('Could not load files');

      const listDiv = document.getElementById('file-list');
      listDiv.innerHTML = '';
      for (const file of data) {
        const { data: urlData } = await supabaseClient.storage.from('documents').createSignedUrl(`uploads/${file.name}`, 60 * 60);
        const link = document.createElement('a');
        link.href = urlData.signedUrl;
        link.textContent = file.name;
        link.download = file.name;
        link.target = '_blank';
        listDiv.appendChild(link);
      }
    }

    function logout() {
      document.getElementById('login-section').classList.remove('hidden');
      document.getElementById('admin-section').classList.add('hidden');
      document.getElementById('employee-section').classList.add('hidden');
    }

    window.onload = function () {
      showLoading(false);
      document.getElementById('loginBtn').addEventListener('click', login);
      document.getElementById('uploadBtn').addEventListener('click', uploadDocument);
      document.getElementById('addEmpBtn').addEventListener('click', addEmployee);
    }
  </script>
</body>
</html>
