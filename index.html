
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UTL Document Portal</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #4e54c8, #8f94fb); min-height: 100vh; display: flex; justify-content: center; align-items: center; color: #333; }
    .container { max-width: 400px; width: 100%; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); text-align: center; }
    .logo { width: 80px; margin-bottom: 10px; }
    h2, h3 { margin: 5px 0; }
    input, button { padding: 12px; margin: 10px 0; width: 100%; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
    button { background: #4e54c8; color: white; border: none; cursor: pointer; transition: background 0.3s; }
    button:hover { background: #3b40a0; }
    .hidden { display: none !important; }
    #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); color: white; display: none; justify-content: center; align-items: center; font-size: 24px; z-index: 999; }
    a { display: block; margin: 5px 0; color: #4e54c8; text-decoration: none; }
  </style>
</head>
<body>
  <div id="loading">Uploading...</div>
  <div class="container">
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATAAAAD6CAMAAAARIeunAAAANlBMVEX+//4BjdLQ5uktVppYbKgJke..." alt="Company Logo" class="logo">
    <h2>United Telecom Limited</h2>
    <h3>Document Portal</h3>
    <div id="login-section">
      <input type="text" id="empId" placeholder="Employee ID or 'admin'" />
      <input type="password" id="password" placeholder="Password" />
      <button id="loginBtn">Login</button>
      <p id="login-error" style="color: red;"></p>
    </div>
    <div id="employee-section" class="hidden">
      <h4 id="welcome-emp">Welcome, Employee</h4>
      <div id="file-list"></div>
      <button onclick="logout()">Logout</button>
    </div>
    <div id="admin-section" class="hidden">
      <h4>Welcome, Admin</h4>
      <input type="file" id="uploadFile" />
      <button id="uploadBtn">Upload</button>
      <p id="upload-status"></p>
      <h5>Add New Employee</h5>
      <input type="text" id="newEmpId" placeholder="Employee ID" />
      <input type="password" id="newEmpPass" placeholder="Password" />
      <button id="addEmpBtn">Create Employee</button>
      <button onclick="logout()">Logout</button>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = 'https://mjdgoqnvkmmutenruqxc.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...';
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);
    function showLoading(show) { document.getElementById('loading').style.display = show ? 'flex' : 'none'; }
    async function login() {
      const empId = document.getElementById('empId').value.trim();
      const password = document.getElementById('password').value.trim();
      const errorDisplay = document.getElementById('login-error');
      errorDisplay.textContent = '';
      if (empId === 'admin' && password === 'karthik') {
        document.getElementById('login-section').classList.add('hidden');
        document.getElementById('admin-section').classList.remove('hidden');
        return;
      }
      const { data, error } = await supabaseClient.from('profiles').select('*').eq('emp_id', empId).single();
      if (error || !data) { errorDisplay.textContent = 'Employee not found.'; return; }
      if (data.password !== password) { errorDisplay.textContent = 'Incorrect password.'; return; }
      document.getElementById('login-section').classList.add('hidden');
      document.getElementById('employee-section').classList.remove('hidden');
      document.getElementById('welcome-emp').textContent = `Welcome, ${data.emp_id}`;
      loadFiles();
    }
    async function uploadDocument() {
      const file = document.getElementById('uploadFile').files[0];
      if (!file) return alert('Select a file.');
      showLoading(true);
      const { error } = await supabaseClient.storage.from('documents').upload(`uploads/${Date.now()}-${file.name}`, file, { upsert: true });
      showLoading(false);
      document.getElementById('upload-status').textContent = error ? '❌ Upload failed' : '✅ Upload successful!';
    }
    async function addEmployee() {
      const empId = document.getElementById('newEmpId').value.trim();
      const password = document.getElementById('newEmpPass').value.trim();
      if (!empId || !password) return alert('Enter ID & Password');
      const { error } = await supabaseClient.from('profiles').insert([{ emp_id: empId, password }]);
      alert(error ? 'Failed to add employee' : 'Employee added successfully');
    }
    async function loadFiles() {
      const { data, error } = await supabaseClient.storage.from('documents').list('uploads');
      if (error) return alert('Load failed');
      const listDiv = document.getElementById('file-list');
      listDiv.innerHTML = '';
      for (const file of data) {
        const { data: urlData } = await supabaseClient.storage.from('documents').createSignedUrl(`uploads/${file.name}`, 3600);
        const link = document.createElement('a');
        link.href = urlData.signedUrl;
        link.textContent = file.name;
        link.download = file.name;
        link.target = '_blank';
        listDiv.appendChild(link);
      }
    }
    function logout() {
      document.getElementById('login-section').classList.remove('hidden');
      document.getElementById('admin-section').classList.add('hidden');
      document.getElementById('employee-section').classList.add('hidden');
    }
    window.onload = () => {
      showLoading(false);
      document.getElementById('loginBtn').onclick = login;
      document.getElementById('uploadBtn').onclick = uploadDocument;
      document.getElementById('addEmpBtn').onclick = addEmployee;
    };
  </script>
</body>
</html>
